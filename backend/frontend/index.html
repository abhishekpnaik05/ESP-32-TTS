<!DOCTYPE html>
<html>
  <head>
    <title>ESP32 Speech + OTA Control</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #f4f4f4;
      }
      #box {
        max-width: 420px;
        margin: auto;
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 0 10px #ccc;
      }
      input, button {
        font-size: 1.1rem;
        padding: 10px;
      }
      button {
        margin-top: 10px;
        background: #0078ff;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      }
      button:hover { background: #005fd1; }
      #log {
        margin-top: 20px;
        height: 200px;
        overflow-y: auto;
        background: #111;
        color: #0f0;
        padding: 10px;
        font-family: monospace;
        border-radius: 8px;
      }
    </style>
  </head>

  <body>
    <div id="box">

      <h2>ESP32 TTS Control</h2>

      <input id="msg" placeholder="Type text to speak" style="width:100%">
      <button onclick="sendMsg()">Send</button>

      <h3>OTA Firmware Update</h3>
      <input type="file" id="binfile" accept=".bin">
      <button onclick="uploadBin()">Upload Firmware</button>
      <button onclick="triggerOTA()">Start OTA Update</button>

      <h3>Log Output</h3>
      <div id="log"></div>

    </div>

    <script>
      const log = (t) => {
        const el = document.getElementById("log");
        el.innerHTML += t + "<br>";
        el.scrollTop = el.scrollHeight;
      };

      const ws = new WebSocket("wss://" + location.host);

      ws.onopen = () => log("ðŸŸ¢ WS Connected");
      ws.onclose = () => log("ðŸ”´ WS Disconnected");
      ws.onerror = () => log("âš  WS Error");
      ws.onmessage = (e) => log("ðŸ“© " + e.data);

      function sendMsg() {
        const t = document.getElementById("msg").value.trim();
        if (!t) return;
        ws.send(t);
        log("âž¡ Sent: " + t);
        document.getElementById("msg").value = "";
      }

      async function uploadBin() {
        const file = document.getElementById("binfile").files[0];
        if (!file) return alert("Select a .bin file!");

        const form = new FormData();
        form.append("firmware", file);

        const res = await fetch("/upload-firmware", {
          method: "POST",
          body: form
        });

        const data = await res.json();
        log("ðŸ“¦ Firmware uploaded");

        alert("Firmware uploaded successfully.");
      }

      function triggerOTA() {
        ws.send("OTA_UPDATE");
        log("ðŸš€ OTA Update triggered");
        alert("OTA command sent to ESP32");
      }
    </script>
  </body>
</html>